services:
  api_gateway:
    container_name: api_gateway
    build:
      context: ./api_gateway
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    command: uvicorn openapi_server.main:app --host 0.0.0.0 --port 3000
  comments:
    container_name: comments_api
    build:
      context: ./microservices/comments
      dockerfile: Dockerfile
    ports:
      - "8080:8080"
    command: uvicorn openapi_server.main:app --host 0.0.0.0 --port 8080
  articles:
    container_name: articles_api
    build:
      context: ./microservices/articles
      dockerfile: Dockerfile
    ports:
      - "8081:8081"
    command: uvicorn openapi_server.main:app --host 0.0.0.0 --port 8081
  ratings:
    container_name: ratings_api
    build:
      context: ./microservices/ratings
      dockerfile: Dockerfile
    ports:
      - "8082:8082"
    command: uvicorn openapi_server.main:app --host 0.0.0.0 --port 8082
  tags:
    container_name: tags_api
    build:
      context: ./microservices/tags
      dockerfile: Dockerfile
    ports:
      - "8083:8083"
    command: uvicorn openapi_server.main:app --host 0.0.0.0 --port 8083
  wikis:
    container_name: wikis_api
    build:
      context: ./microservices/wikis
      dockerfile: Dockerfile
    ports:
      - "8084:8084"
    command: uvicorn openapi_server.main:app --host 0.0.0.0 --port 8084
  libretranslate:
    container_name: libretranslate
    build:
      context: ./microservices/libre_translate
      dockerfile: docker/Dockerfile
    restart: unless-stopped
    ports:
      - "5000:5000"
    ## Uncomment this for logging in docker compose logs
    # tty: true
    # healthcheck:
    #   test: ['CMD-SHELL', './venv/bin/python scripts/healthcheck.py']     
    ## Uncomment above command and define your args if necessary
    # command: --ssl --ga-id MY-GA-ID --req-limit 100 --char-limit 500
    ## Uncomment this section and the libretranslate_api_keys volume if you want to backup your API keys
    environment:
    #   - LT_API_KEYS=true
    #   - LT_API_KEYS_DB_PATH=/app/db/api_keys.db # Same result as `db/api_keys.db` or `./db/api_keys.db`
    ## Uncomment these vars and libretranslate_models volume to optimize loading time.
      - LT_UPDATE_MODELS=true
      - LT_LOAD_ONLY=en,es,fr
    # volumes:
    #   - libretranslate_api_keys:/app/db
    # Keep the models in a docker volume, to avoid re-downloading on startup
    #   - libretranslate_models:/home/libretranslate/.local:rw

# volumes:
#   libretranslate_api_keys:
#   libretranslate_models:
  